"use client";
import { useMemo } from "react";

/**
 * AsciiBackground — dark-only (uses your CSS variables: --background, --foreground, ...)
 */
export default function AsciiBackground({
  ascii,
  opacity = 0.22,
  blur = 0,
  scale = 1,
  drift = true,
  className = "",
}) {
  const defaultAscii = useMemo(
    () =>
      `
               +----=+     +=== =--=----=---:::::::---::::::---=-------=  ===-------=               
          =+   =-----=+    +--==-------::::::::::::::::::::::-==------===--------=             =    
          =+-  =------=+=  +--=+----::::::::::::::::::::::::--==-----+---------=   ====      ===    
          ==+  =-------====+--==--::::::::::::::::::::::::::-==--::-=---------- =-==+      ==-=-    
           =-= +=--------=-=---=-::::::::::::::::::::::::::=---::::-::::---------==     -==---=     
           =--=-=----------::::::::::::::::::::::::::::::-=--=:::::::::::--:----     --------=      
           =--==+==--:::::::::::::::::::::::::::::::::::-=--=::::::::::::----==-------------+       
            =---++=--:::::::::::::::::::::::::::::::::------::::::::::::::-=---:--::::----=+=       
            =----===-:::::::::::::::::::::::::::::::::::-=-::::::::::::::---::::::::::---===        
             =----===-::::::::::::::::::::::::::::::::-=-:::::::::::::::=-::::::::::::--=--         
             =-----===:::::::::::::::::::::::::::::::-::::::::::::::::-=::::::::::::--=---      ==  
               =---:-=--:::::::::::::::::::::::::::::::::::::::::::::--::::::::::::-=---=     ==-=  
   -=====-------==-:::-=::::::::::::::::::::::::::::::::::::::::::::::::::::.::::--:---=    ==--=   
==------::::::::::::::::=-:::::::::::::::-:::::::::::::::::::::::::::::::.::::::::::--  ===----=    
===------::::::::::::::::--::::::::::::--::::::::::::::::---::::::::::::::::::::::-==----::::-=     
   =====---::::::::::::::::--:::::::::--:::::::::::::::-==-:::::::::::::::::::::::::::::::::--      
      +=--==-:::::::::::::::::::::::---:::::::::::::---=-:::::::::::::::::::::::::::::::::--        
        -=---=--:::::::::::::::::::=---:::::::::::-==-=---::::::::-::::::---::::::::::::--       ===
           ==----::::::--::::::::--=-----:::::::--=--=---------=-----==--::::--::::::-=-   --==--=- 
=+==          =---:::::-=:-::::---=--=-----------=--=-------==---==-----:--:---::::--:::::----==    
 =-----=======--:::::--==---------=--==---------=--==----==---==------------=-:::::::---=====-      
   ==----::::-:::::----===--------==-==-------==---=---==---==-----------=-=--:::-------===-        
     -=-----------------===-------======------=---=====--===-----------=-==----:::-::::--:::-=-     
        -=--------------====-----======+============+======---------===-==--------------==-----=    
         -===+=====------===+======+==+=+=========++=======------======+=======--====----==-        
     ==-----------------==+==+=====+==++=+===+====+==============+===+=++==--------=----==-=-       
               .:++========+==++====+==+==+==+================++===+++======+#@%%+                  
                   +**#%%#****++++===++=++===+==============+===++++**##%%%%%%%%%%                  
                   *#******#%%%%%%%%%%%###**+++=======++*####%%%%%%%%%%%%%%%##*#%                   
                    #%%%%%###***%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%****#%%@%                  
                 +--+#***#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@%%*---=+                
                +=-++#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@%%%%%%++**-*                
               ++==-=%%%%%%%%%%%%%%%%#*##%%%%%%%%%%%%%%%%%%%#****#%%%%%%%%%%%%#++*++                
               #---=#*%%%%%%%%%%%%%%%%%#*+++*%%%%%%%%%%%*++++*#%%%%%%%%%%%%%%#+**=-==               
               #--=#++*%%%%%%%%%%%%%%%%%%%#*+*#%%%%%%%%*+++*#%%%%%%%%%%%%%%%%#*++*-=+               
                *-*+++**@%%%%%%%%%%%%%%%%%%%%##%%%%%%%#+++*#%%%%%%%%%%%%%%%%#=*+++-+                
                *=+*++#=**%%%%%%%%%%%%%%%%%%%%%%%%%%%%#++*%%#%%%%%%%%%%%%%#==#++**=+                
                 *=+*++#**-*%%%%%%%%%%%%%%%**##%%%%%%%#++*%%%%%%%%%%%%%%#-=#*++**=*                 
                  *-+*++*#=--=*%%%%%%%%%%%%%%%%%%%%%%%%%##%%%%%%%%%%%#=::-**++#+=#                  
                   *-=*#+*+---::-=*%%%%%%%%%%%%%+--:-*+#%%%%%%%%#%#=:::::-*#+=-=*                   
                    #=---+#--::::::::-+%%#%#=::::::::*====+%%#%*-::::::::==---=+                    
                     %+---+=-::::::::::::::::::::::::+====-:::::::::::::-+====*                     
                       #+--*-::::::::::::::::::::::::+===-::::::::::::::-#                          
                           #*::::::::::::::::::::::::-=-::::::::::::::::+                           
                          %@%=:::::::::::::::::::::::::::::::::::::::::-##                          
                   *@@%@@@@@@#-::::::::::::::::::::::::::::::::::::::::+@@@@@@%@@*                  
              #@@@@@@@@@@@@@@@+:::::::::::::::::---::-::::::::::::::::-%@@@@@@@@@@@%@%              
          %@@@@@@@@@@@@@@@@@@@@=:::::::::::::::::::::::::::::--:::::::*@@@@@@@@@@@@@@@@@@%          
         @@@@@@@@@@@@@@@@@@@@@@@*-:::::::==========---:---==+-:::::::+@@@@@@@@@@@@@@@@@@@@@%        
         %%@@@@@@@@@@@@@@@@@@@@@**=::::::::::::::-::::::::::::::::::*@@@@@@@@@@@@@@@@@@@@%##@       
          %###@@@@@@@@@@@@@@@@@@%+**::::::::::::-*###+=:::::::::::-#*@@@@@@@@@@@@@@%#***###%        
           %#####%@@@@@@@@@@@@@@@*++*+-::::::::::------:::::::::-=*+*@@@@@@@@%%#*********###        
            %########%@@@@@@@@@@@#+++**=--::::::::::::::::::::--+**#%@%%##*******###%%%%###         
            ################%%%@@@%%%#*#%###+=--:::---=+*###%######*****###%%%%%%@@%%@@@%#%         
             #########################%@%#####################%%%%%%%%%%%%%%%%%%%%%@@@@@%%          
              %##%@@@@%%%%%%%%%%%@@%@@@@@###%%%@%@@%%@@@%@@@@@@@%%%%%%%%%%%%%%%%@@@@@@@@%           
               #@@@@@@@@@%%%%%%%%%%@@@@@@##%@@@%%%%%%@@@%@@@@@@%@@@%%%%%%%@@@@@@@@@@@@@@            
              %#%@@@@@@@@@@@%%%%%%%%@@@@@%#%@@@%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%##%%           
             ##@@@@@@@@@@@@@@@@@@@@@@@@@@%#@@@@@@%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#######          
             #####%%@@@@@@@@@@@@@@@@@@@@@@%%#%@@@@%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#####%%#%%%%%      
           %%*%#############%@@@@@@@@@@@@@*%==+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%####%%%%@@##***#%+   
        %###*##%#####%@@@@@@@@@@@@@@%*#@@@#=#+--*@@@@%@@@@@@@@@@@@@@@@@@@@@@%###%@%@%%%@@%%%%****###
    #%%##*#%%%%%%%###%@@%%@@@@@@@@@%+++++*%*-==::-*%%@@@@@@@@@@@@@@@@@@@@%%##%%@%%%%@@@@%%%%%%******
**********#%%%%@@@@###%%%%%%%%%%@@@@%*++++++#=:::::-+%@@@@@%%%%%#####%%%%%%@@%%%%@%@@@%%%%%#***#%%%%
************%%%%@%@@@#%%%%%%%%%%%%@@@@*++++++#*:::::::=%%%%%%%%@@@@@@@@@@@@@@%%%%@@@%%%%%#**%%%%%%%%
++++**#%%##***#%@%%%%%%%@%%%%%%%%%%%%%@@#++++=+#+-::::::-#@@%%%@%%%%%%@@@@@@@@@@@@%%%%###%%%%%%%%%%%
++++++*%%%%%%%%###%@@@@@@@@@@%%%%%%%%%%@%@%%#*+==*=::::::-#%%%%%%%%%%%%%%@@@@@@@@%%%%%%%%%%%%%%%%%%*
+++++++*#%%%%%%%%%%%%@@@@@@@@@@@@@@@%@@@@%#%@%+===#-:::::::#@%%%%%%%%@@@%@@@@@%%%%%%%%%%%%%%%%%%%*++
+++++++++*#%%%%%%%%%%%%%@@@@@@%#*+=-:::-+:::::-=*##%+-::::::=%%%%%%@@@@@@%%@%%%%%%%%%%%%%%%%%%%*++++
+++++++++++*#%%%%%%%%%%%%%%@@@%*++=-:::::::::::::::-=++*-::::-#%@@@@@@%%%%%%%%%%%%%%%%%%%%%%#*++++++
*+++++++++++*##%%%%%%%%%%%%%@@@*-:::::::::::::::::::::::*#**=-=@@@%%%%%%%%%%%%%%%%%%%%%%%%#*++++++++
%%#*++++++++**#**%%%%%%%%%%%%%%%@@@%%%%@@@#%=::::+#%*-:::=*-=#%%@@%%%%%%%%%%%%%%%%%%%%%%%*++++++++++
%%%%#**++++****#*###%%%%%%%%%%%%%%%%%@%#+===+##*==-::-++-:-*==+*-#%%%%%%%%%%%%%%%%%%%%#*++++++++++++
    `.trimEnd(),
    [],
  );

  const art = ascii ?? defaultAscii;

  return (
    <div
      aria-hidden="true"
      className={`ascii-bg ${drift ? "ascii-drift" : ""} ${className}`}
      style={{
        "--ascii-opacity": opacity,
        "--ascii-blur": `${blur}px`,
        "--ascii-scale": scale,
      }}
    >
      <pre className="ascii-pre">{art}</pre>

      {/* Overlays */}
      <div className="ascii-scanlines" />
      <div className="ascii-noise" />

      <style jsx>{`
        /* base: dark background from your CSS variables */
        .ascii-bg {
          position: fixed;
          inset: 0;
          z-index: -1;
          pointer-events: none;
          overflow: hidden;

          /* base background color MUST come from your theme variables (dark) */
          background-color: var(--background, #071026);

          /* subtle radial highlights (dark-tinted, not white) */
          background-image:
            radial-gradient(
              1200px 700px at 10% 10%,
              color-mix(in srgb, var(--background) 85%, var(--foreground) 3%),
              transparent 55%
            ),
            radial-gradient(
              900px 600px at 90% 30%,
              color-mix(in srgb, var(--background) 88%, var(--foreground) 2%),
              transparent 50%
            );
        }

        .ascii-pre {
          position: absolute;
          left: 50%;
          top: 50%;
          transform: translate(-50%, -50%) scale(var(--ascii-scale));
          transform-origin: center;
          margin: 0;
          padding: 0;
          white-space: pre;
          font-family:
            ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
            "Liberation Mono", "Courier New", monospace;
          font-size: clamp(10px, 1.2vw, 14px);
          line-height: 1.1;
          letter-spacing: 0.08em;

          /* use theme foreground color; opacity controlled by --ascii-opacity */
          color: var(--foreground, #e6eef6);
          opacity: var(--ascii-opacity, 0.22);
          filter: blur(var(--ascii-blur));
          user-select: none;
          mix-blend-mode: screen; /* gives a light-on-dark glow */
          text-shadow:
            0 0 0.5px color-mix(in srgb, var(--foreground) 65%, transparent),
            0 0 6px color-mix(in srgb, var(--foreground) 12%, transparent);
          pointer-events: none;
        }

        /* Drift (défilement très lent) */
        .ascii-drift .ascii-pre {
          animation: drift 18s linear infinite;
        }
        @keyframes drift {
          0% {
            transform: translate(-50%, -52%) scale(var(--ascii-scale));
          }
          50% {
            transform: translate(-50%, -48%) scale(var(--ascii-scale));
          }
          100% {
            transform: translate(-50%, -52%) scale(var(--ascii-scale));
          }
        }

        /* Scanlines — tuned for dark background */
        .ascii-scanlines {
          position: absolute;
          inset: 0;
          background: repeating-linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.02),
            rgba(255, 255, 255, 0.02) 1px,
            rgba(0, 0, 0, 0) 3px,
            rgba(0, 0, 0, 0) 6px
          );
          mix-blend-mode: overlay;
          opacity: 0.28;
          pointer-events: none;
        }

        /* Noise — gentle, dark-friendly */
        .ascii-noise {
          position: absolute;
          inset: 0;
          background-image:
            radial-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
            radial-gradient(rgba(0, 0, 0, 0.06) 1px, transparent 1px);
          background-size:
            3px 3px,
            4px 4px;
          background-position:
            0 0,
            1px 1px;
          opacity: 0.06;
          mix-blend-mode: soft-light;
          animation: noiseShift 1.8s steps(2) infinite;
          pointer-events: none;
        }

        @keyframes noiseShift {
          0% {
            transform: translate(0, 0);
          }
          25% {
            transform: translate(1px, -1px);
          }
          50% {
            transform: translate(-1px, 1px);
          }
          75% {
            transform: translate(1px, 1px);
          }
          100% {
            transform: translate(0, 0);
          }
        }

        /* ensure the ascii layer remains behind UI but above the pure background */
        @media (prefers-reduced-motion: reduce) {
          .ascii-drift .ascii-pre {
            animation: none;
          }
          .ascii-noise {
            animation: none;
          }
        }
      `}</style>
    </div>
  );
}
